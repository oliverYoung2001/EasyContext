+ export CUDA_DEVICE_MAX_CONNECTIONS=1
+ CUDA_DEVICE_MAX_CONNECTIONS=1
+ srun -p arch -N 2 --ntasks-per-node=8 --gres=gpu:8 --mem 256G -K -w g3029,g3030 -c 16 ./scripts/bench_ring_attn.sh python bench_ring_attn.py
srun: job 3675 queued and waiting for resources
srun: job 3675 has been allocated resources
torch distributed is already initialized, skipping initialization ...
************ Finish sequence pralell group Initialization. ***********
Nh=32, S=8192
# zigzag_ring_flash_attn_func, fwd
mfu: 3.948 Tflops/s, hfu: 3.948 Tflops/s, 114.893 iter/s, 0.174 sec
# hierarchy_attn_func, fwd
mfu: 14.471 Tflops/s, hfu: 14.471 Tflops/s, 421.149 iter/s, 0.047 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 15.617 Tflops/s, hfu: 15.617 Tflops/s, 454.509 iter/s, 0.044 sec
Nh=32, S=16384
# zigzag_ring_flash_attn_func, fwd
mfu: 12.023 Tflops/s, hfu: 12.023 Tflops/s, 87.479 iter/s, 0.229 sec
# hierarchy_attn_func, fwd
mfu: 34.522 Tflops/s, hfu: 34.522 Tflops/s, 251.178 iter/s, 0.080 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 38.256 Tflops/s, hfu: 38.256 Tflops/s, 278.351 iter/s, 0.072 sec
Nh=32, S=32768
# zigzag_ring_flash_attn_func, fwd
mfu: 23.976 Tflops/s, hfu: 23.976 Tflops/s, 43.612 iter/s, 0.459 sec
# hierarchy_attn_func, fwd
mfu: 62.546 Tflops/s, hfu: 62.546 Tflops/s, 113.770 iter/s, 0.176 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 65.601 Tflops/s, hfu: 65.601 Tflops/s, 119.328 iter/s, 0.168 sec
Nh=32, S=65536
# zigzag_ring_flash_attn_func, fwd
mfu: 47.897 Tflops/s, hfu: 47.897 Tflops/s, 21.781 iter/s, 0.918 sec
# hierarchy_attn_func, fwd
mfu: 92.872 Tflops/s, hfu: 92.872 Tflops/s, 42.233 iter/s, 0.474 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 100.34 Tflops/s, hfu: 100.34 Tflops/s, 45.630 iter/s, 0.438 sec
Nh=32, S=131072
# zigzag_ring_flash_attn_func, fwd
mfu: 93.721 Tflops/s, hfu: 93.721 Tflops/s, 10.655 iter/s, 1.877 sec
# hierarchy_attn_func, fwd
mfu: 117.993 Tflops/s, hfu: 117.993 Tflops/s, 13.414 iter/s, 1.491 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 126.615 Tflops/s, hfu: 126.615 Tflops/s, 14.395 iter/s, 1.389 sec
Nh=32, S=262144
# zigzag_ring_flash_attn_func, fwd
mfu: 181.63 Tflops/s, hfu: 181.63 Tflops/s, 5.162 iter/s, 3.874 sec
# hierarchy_attn_func, fwd
mfu: 134.589 Tflops/s, hfu: 134.589 Tflops/s, 3.825 iter/s, 5.228 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 139.924 Tflops/s, hfu: 139.924 Tflops/s, 3.977 iter/s, 5.029 sec
Nh=40, S=8192
# zigzag_ring_flash_attn_func, fwd
mfu: 6.043 Tflops/s, hfu: 6.043 Tflops/s, 140.690 iter/s, 0.142 sec
# hierarchy_attn_func, fwd
mfu: 15.553 Tflops/s, hfu: 15.553 Tflops/s, 362.120 iter/s, 0.055 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 18.773 Tflops/s, hfu: 18.773 Tflops/s, 437.082 iter/s, 0.046 sec
Nh=40, S=16384
# zigzag_ring_flash_attn_func, fwd
mfu: 12.002 Tflops/s, hfu: 12.002 Tflops/s, 69.859 iter/s, 0.286 sec
# hierarchy_attn_func, fwd
mfu: 35.989 Tflops/s, hfu: 35.989 Tflops/s, 209.484 iter/s, 0.095 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 40.995 Tflops/s, hfu: 40.995 Tflops/s, 238.623 iter/s, 0.084 sec
Nh=40, S=32768
# zigzag_ring_flash_attn_func, fwd
mfu: 24.086 Tflops/s, hfu: 24.086 Tflops/s, 35.049 iter/s, 0.571 sec
# hierarchy_attn_func, fwd
mfu: 63.621 Tflops/s, hfu: 63.621 Tflops/s, 92.581 iter/s, 0.216 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 72.31 Tflops/s, hfu: 72.31 Tflops/s, 105.225 iter/s, 0.190 sec
Nh=40, S=65536
# zigzag_ring_flash_attn_func, fwd
mfu: 47.723 Tflops/s, hfu: 47.723 Tflops/s, 17.362 iter/s, 1.152 sec
# hierarchy_attn_func, fwd
mfu: 93.573 Tflops/s, hfu: 93.573 Tflops/s, 34.041 iter/s, 0.588 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 105.322 Tflops/s, hfu: 105.322 Tflops/s, 38.316 iter/s, 0.522 sec
Nh=40, S=131072
# zigzag_ring_flash_attn_func, fwd
mfu: 93.637 Tflops/s, hfu: 93.637 Tflops/s, 8.516 iter/s, 2.348 sec
# hierarchy_attn_func, fwd
mfu: 117.918 Tflops/s, hfu: 117.918 Tflops/s, 10.725 iter/s, 1.865 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 126.373 Tflops/s, hfu: 126.373 Tflops/s, 11.494 iter/s, 1.740 sec
Nh=40, S=262144
# zigzag_ring_flash_attn_func, fwd
mfu: 179.103 Tflops/s, hfu: 179.103 Tflops/s, 4.072 iter/s, 4.911 sec
# hierarchy_attn_func, fwd
mfu: 132.53 Tflops/s, hfu: 132.53 Tflops/s, 3.013 iter/s, 6.637 sec
# overlapped_hierarchy_attn_func, fwd
mfu: 137.806 Tflops/s, hfu: 137.806 Tflops/s, 3.133 iter/s, 6.383 sec
Nh=80, S=8192
# zigzag_ring_flash_attn_func, fwd
mfu: 6.069 Tflops/s, hfu: 6.069 Tflops/s, 70.656 iter/s, 0.283 sec
# hierarchy_attn_func, fwd
