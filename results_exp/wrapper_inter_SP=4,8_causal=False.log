+ export CUDA_DEVICE_MAX_CONNECTIONS=32
+ CUDA_DEVICE_MAX_CONNECTIONS=32
+ srun -p arch -N 4 --ntasks-per-node=8 --gres=gpu:8 --mem 256G -K -w g3025,g3026,g3027,g3028 -c 16 ./scripts/bench_ring_attn.sh python bench_ring_attn.py
srun: job 18402 queued and waiting for resources
srun: job 18402 has been allocated resources
torch distributed is already initialized, skipping initialization ...
************ Finish sequence pralell group Initialization. ***********
Sqkvs: [256, 512, 1024, 2048, 4096, 8192, 16384]
total_size: 30299652096
causal=False, fob=0:
da_config: SP=(4,8),Sg=(256,256),S=(8192,8192),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 0.074 Tflops/s, hfu: 0.074 Tflops/s, 68.887 iter/s, 1.452e-02 s/iter, (7.356, 0.001, 0.058) sec
# orchestrated_attn_func
mfu: 1.934 Tflops/s, hfu: 1.934 Tflops/s, 1801.438 iter/s, 5.551e-04 s/iter, (6.322, 0.001, 0.002) sec
mfu: 2.144 Tflops/s, hfu: 2.144 Tflops/s, 1996.614 iter/s, 5.008e-04 s/iter, (0.181, 0.001, 0.002) sec
mfu: 2.105 Tflops/s, hfu: 2.105 Tflops/s, 1960.723 iter/s, 5.100e-04 s/iter, (0.179, 0.001, 0.002) sec
mfu: 1.73 Tflops/s, hfu: 1.73 Tflops/s, 1610.908 iter/s, 6.208e-04 s/iter, (0.501, 0.001, 0.002) sec
mfu: 2.228 Tflops/s, hfu: 2.228 Tflops/s, 2074.792 iter/s, 4.820e-04 s/iter, (0.193, 0.001, 0.002) sec
mfu: 2.468 Tflops/s, hfu: 2.468 Tflops/s, 2298.512 iter/s, 4.351e-04 s/iter, (0.180, 0.001, 0.002) sec
da_config: SP=(4,8),Sg=(512,512),S=(16384,16384),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 0.302 Tflops/s, hfu: 0.302 Tflops/s, 70.367 iter/s, 1.421e-02 s/iter, (0.030, 0.001, 0.057) sec
# orchestrated_attn_func
mfu: 6.289 Tflops/s, hfu: 6.289 Tflops/s, 1464.300 iter/s, 6.829e-04 s/iter, (0.180, 0.000, 0.003) sec
mfu: 7.93 Tflops/s, hfu: 7.93 Tflops/s, 1846.408 iter/s, 5.416e-04 s/iter, (0.180, 0.001, 0.002) sec
mfu: 7.012 Tflops/s, hfu: 7.012 Tflops/s, 1632.493 iter/s, 6.126e-04 s/iter, (0.180, 0.001, 0.002) sec
mfu: 7.342 Tflops/s, hfu: 7.342 Tflops/s, 1709.355 iter/s, 5.850e-04 s/iter, (0.181, 0.001, 0.002) sec
mfu: 7.13 Tflops/s, hfu: 7.13 Tflops/s, 1660.093 iter/s, 6.024e-04 s/iter, (0.185, 0.001, 0.002) sec
mfu: 12.782 Tflops/s, hfu: 12.782 Tflops/s, 2976.120 iter/s, 3.360e-04 s/iter, (0.179, 0.001, 0.001) sec
da_config: SP=(4,8),Sg=(1024,1024),S=(32768,32768),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 1.23 Tflops/s, hfu: 1.23 Tflops/s, 71.592 iter/s, 1.397e-02 s/iter, (0.033, 0.001, 0.056) sec
# orchestrated_attn_func
mfu: 25.651 Tflops/s, hfu: 25.651 Tflops/s, 1493.072 iter/s, 6.698e-04 s/iter, (0.181, 0.001, 0.003) sec
mfu: 21.068 Tflops/s, hfu: 21.068 Tflops/s, 1226.344 iter/s, 8.154e-04 s/iter, (0.187, 0.001, 0.003) sec
mfu: 26.921 Tflops/s, hfu: 26.921 Tflops/s, 1567.005 iter/s, 6.382e-04 s/iter, (0.180, 0.000, 0.003) sec
mfu: 24.431 Tflops/s, hfu: 24.431 Tflops/s, 1422.054 iter/s, 7.032e-04 s/iter, (0.179, 0.001, 0.003) sec
mfu: 22.768 Tflops/s, hfu: 22.768 Tflops/s, 1325.276 iter/s, 7.546e-04 s/iter, (0.181, 0.001, 0.003) sec
mfu: 27.956 Tflops/s, hfu: 27.956 Tflops/s, 1627.265 iter/s, 6.145e-04 s/iter, (0.179, 0.001, 0.002) sec
da_config: SP=(4,8),Sg=(2048,2048),S=(65536,65536),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 4.938 Tflops/s, hfu: 4.938 Tflops/s, 71.851 iter/s, 1.392e-02 s/iter, (0.032, 0.001, 0.056) sec
# orchestrated_attn_func
mfu: 60.086 Tflops/s, hfu: 60.086 Tflops/s, 874.364 iter/s, 1.144e-03 s/iter, (0.181, 0.001, 0.005) sec
mfu: 57.822 Tflops/s, hfu: 57.822 Tflops/s, 841.417 iter/s, 1.188e-03 s/iter, (0.186, 0.001, 0.005) sec
mfu: 61.665 Tflops/s, hfu: 61.665 Tflops/s, 897.337 iter/s, 1.114e-03 s/iter, (0.183, 0.000, 0.004) sec
mfu: 55.484 Tflops/s, hfu: 55.484 Tflops/s, 807.405 iter/s, 1.239e-03 s/iter, (0.180, 0.001, 0.005) sec
mfu: 56.974 Tflops/s, hfu: 56.974 Tflops/s, 829.077 iter/s, 1.206e-03 s/iter, (0.182, 0.001, 0.005) sec
mfu: 64.515 Tflops/s, hfu: 64.515 Tflops/s, 938.819 iter/s, 1.065e-03 s/iter, (3.525, 0.001, 0.004) sec
da_config: SP=(4,8),Sg=(4096,4096),S=(131072,131072),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 21.053 Tflops/s, hfu: 21.053 Tflops/s, 76.591 iter/s, 1.306e-02 s/iter, (0.032, 0.001, 0.052) sec
# orchestrated_attn_func
mfu: 100.517 Tflops/s, hfu: 100.517 Tflops/s, 365.679 iter/s, 2.735e-03 s/iter, (0.187, 0.001, 0.011) sec
mfu: 97.724 Tflops/s, hfu: 97.724 Tflops/s, 355.519 iter/s, 2.813e-03 s/iter, (0.184, 0.001, 0.011) sec
mfu: 106.049 Tflops/s, hfu: 106.049 Tflops/s, 385.802 iter/s, 2.592e-03 s/iter, (0.185, 0.001, 0.010) sec
mfu: 108.622 Tflops/s, hfu: 108.622 Tflops/s, 395.166 iter/s, 2.531e-03 s/iter, (3.551, 0.001, 0.010) sec
mfu: 117.052 Tflops/s, hfu: 117.052 Tflops/s, 425.833 iter/s, 2.348e-03 s/iter, (0.184, 0.001, 0.009) sec
mfu: 121.142 Tflops/s, hfu: 121.142 Tflops/s, 440.710 iter/s, 2.269e-03 s/iter, (0.183, 0.001, 0.009) sec
da_config: SP=(4,8),Sg=(8192,8192),S=(262144,262144),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 77.474 Tflops/s, hfu: 77.474 Tflops/s, 70.462 iter/s, 1.419e-02 s/iter, (0.031, 0.001, 0.057) sec
# orchestrated_attn_func
mfu: 160.407 Tflops/s, hfu: 160.407 Tflops/s, 145.889 iter/s, 6.855e-03 s/iter, (0.194, 0.001, 0.027) sec
mfu: 162.553 Tflops/s, hfu: 162.553 Tflops/s, 147.841 iter/s, 6.764e-03 s/iter, (0.192, 0.001, 0.027) sec
mfu: 162.544 Tflops/s, hfu: 162.544 Tflops/s, 147.833 iter/s, 6.764e-03 s/iter, (0.192, 0.001, 0.027) sec
mfu: 160.495 Tflops/s, hfu: 160.495 Tflops/s, 145.970 iter/s, 6.851e-03 s/iter, (0.194, 0.001, 0.027) sec
mfu: 165.298 Tflops/s, hfu: 165.298 Tflops/s, 150.338 iter/s, 6.652e-03 s/iter, (0.194, 0.001, 0.027) sec
mfu: 181.298 Tflops/s, hfu: 181.298 Tflops/s, 164.890 iter/s, 6.065e-03 s/iter, (0.191, 0.001, 0.024) sec
da_config: SP=(4,8),Sg=(16384,16384),S=(524288,524288),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 122.275 Tflops/s, hfu: 122.275 Tflops/s, 27.802 iter/s, 3.597e-02 s/iter, (0.074, 0.001, 0.144) sec
# orchestrated_attn_func
mfu: 194.333 Tflops/s, hfu: 194.333 Tflops/s, 44.186 iter/s, 2.263e-02 s/iter, (0.226, 0.001, 0.091) sec
mfu: 196.712 Tflops/s, hfu: 196.712 Tflops/s, 44.727 iter/s, 2.236e-02 s/iter, (0.224, 0.001, 0.089) sec
mfu: 197.554 Tflops/s, hfu: 197.554 Tflops/s, 44.919 iter/s, 2.226e-02 s/iter, (0.225, 0.001, 0.089) sec
mfu: 199.258 Tflops/s, hfu: 199.258 Tflops/s, 45.306 iter/s, 2.207e-02 s/iter, (0.223, 0.001, 0.088) sec
mfu: 205.277 Tflops/s, hfu: 205.277 Tflops/s, 46.675 iter/s, 2.142e-02 s/iter, (0.222, 0.001, 0.086) sec
mfu: 206.141 Tflops/s, hfu: 206.141 Tflops/s, 46.871 iter/s, 2.134e-02 s/iter, (0.223, 0.001, 0.085) sec
da_config: SP=(4,8),Sg=(256,256),S=(8192,8192),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 2.666 Tflops/s, hfu: 2.666 Tflops/s, 77.602 iter/s, 1.289e-02 s/iter, (0.031, 0.001, 0.052) sec
# orchestrated_attn_func
mfu: 15.758 Tflops/s, hfu: 15.758 Tflops/s, 458.611 iter/s, 2.180e-03 s/iter, (13.903, 0.001, 0.009) sec
mfu: 18.432 Tflops/s, hfu: 18.432 Tflops/s, 536.446 iter/s, 1.864e-03 s/iter, (0.185, 0.001, 0.007) sec
mfu: 20.4 Tflops/s, hfu: 20.4 Tflops/s, 593.728 iter/s, 1.684e-03 s/iter, (0.188, 0.001, 0.007) sec
mfu: 17.18 Tflops/s, hfu: 17.18 Tflops/s, 500.000 iter/s, 2.000e-03 s/iter, (12.726, 0.001, 0.008) sec
mfu: 18.132 Tflops/s, hfu: 18.132 Tflops/s, 527.711 iter/s, 1.895e-03 s/iter, (0.188, 0.001, 0.008) sec
mfu: 19.672 Tflops/s, hfu: 19.672 Tflops/s, 572.523 iter/s, 1.747e-03 s/iter, (0.211, 0.001, 0.007) sec
da_config: SP=(4,8),Sg=(512,512),S=(16384,16384),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 9.54 Tflops/s, hfu: 9.54 Tflops/s, 69.410 iter/s, 1.441e-02 s/iter, (0.036, 0.001, 0.058) sec
# orchestrated_attn_func
mfu: 43.73 Tflops/s, hfu: 43.73 Tflops/s, 318.179 iter/s, 3.143e-03 s/iter, (0.191, 0.001, 0.013) sec
mfu: 44.31 Tflops/s, hfu: 44.31 Tflops/s, 322.398 iter/s, 3.102e-03 s/iter, (0.186, 0.001, 0.012) sec
mfu: 44.213 Tflops/s, hfu: 44.213 Tflops/s, 321.690 iter/s, 3.109e-03 s/iter, (0.188, 0.001, 0.012) sec
mfu: 38.104 Tflops/s, hfu: 38.104 Tflops/s, 277.241 iter/s, 3.607e-03 s/iter, (0.189, 0.001, 0.014) sec
mfu: 45.905 Tflops/s, hfu: 45.905 Tflops/s, 334.003 iter/s, 2.994e-03 s/iter, (0.192, 0.001, 0.012) sec
mfu: 47.582 Tflops/s, hfu: 47.582 Tflops/s, 346.205 iter/s, 2.888e-03 s/iter, (0.211, 0.001, 0.012) sec
da_config: SP=(4,8),Sg=(1024,1024),S=(32768,32768),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 21.878 Tflops/s, hfu: 21.878 Tflops/s, 39.795 iter/s, 2.513e-02 s/iter, (0.054, 0.001, 0.101) sec
# orchestrated_attn_func
mfu: 95.363 Tflops/s, hfu: 95.363 Tflops/s, 173.464 iter/s, 5.765e-03 s/iter, (0.196, 0.001, 0.023) sec
mfu: 95.798 Tflops/s, hfu: 95.798 Tflops/s, 174.256 iter/s, 5.739e-03 s/iter, (0.194, 0.001, 0.023) sec
mfu: 99.769 Tflops/s, hfu: 99.769 Tflops/s, 181.479 iter/s, 5.510e-03 s/iter, (0.194, 0.000, 0.022) sec
mfu: 69.693 Tflops/s, hfu: 69.693 Tflops/s, 126.772 iter/s, 7.888e-03 s/iter, (0.197, 0.001, 0.032) sec
mfu: 91.825 Tflops/s, hfu: 91.825 Tflops/s, 167.028 iter/s, 5.987e-03 s/iter, (0.198, 0.001, 0.024) sec
mfu: 91.971 Tflops/s, hfu: 91.971 Tflops/s, 167.294 iter/s, 5.977e-03 s/iter, (0.196, 0.001, 0.024) sec
da_config: SP=(4,8),Sg=(2048,2048),S=(65536,65536),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 40.43 Tflops/s, hfu: 40.43 Tflops/s, 18.385 iter/s, 5.439e-02 s/iter, (0.112, 0.001, 0.218) sec
# orchestrated_attn_func
mfu: 147.744 Tflops/s, hfu: 147.744 Tflops/s, 67.186 iter/s, 1.488e-02 s/iter, (0.212, 0.001, 0.060) sec
mfu: 153.568 Tflops/s, hfu: 153.568 Tflops/s, 69.834 iter/s, 1.432e-02 s/iter, (0.214, 0.001, 0.057) sec
mfu: 160.429 Tflops/s, hfu: 160.429 Tflops/s, 72.954 iter/s, 1.371e-02 s/iter, (0.211, 0.001, 0.055) sec
mfu: 109.641 Tflops/s, hfu: 109.641 Tflops/s, 49.859 iter/s, 2.006e-02 s/iter, (0.223, 0.001, 0.080) sec
mfu: 136.044 Tflops/s, hfu: 136.044 Tflops/s, 61.866 iter/s, 1.616e-02 s/iter, (0.216, 0.001, 0.065) sec
mfu: 148.345 Tflops/s, hfu: 148.345 Tflops/s, 67.459 iter/s, 1.482e-02 s/iter, (0.220, 0.001, 0.059) sec
da_config: SP=(4,8),Sg=(4096,4096),S=(131072,131072),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 68.06 Tflops/s, hfu: 68.06 Tflops/s, 7.738 iter/s, 1.292e-01 s/iter, (0.256, 0.001, 0.517) sec
# orchestrated_attn_func
mfu: 193.972 Tflops/s, hfu: 193.972 Tflops/s, 22.052 iter/s, 4.535e-02 s/iter, (0.300, 0.001, 0.181) sec
mfu: 193.782 Tflops/s, hfu: 193.782 Tflops/s, 22.030 iter/s, 4.539e-02 s/iter, (0.278, 0.000, 0.182) sec
mfu: 204.545 Tflops/s, hfu: 204.545 Tflops/s, 23.254 iter/s, 4.300e-02 s/iter, (0.272, 0.001, 0.172) sec
mfu: 147.523 Tflops/s, hfu: 147.523 Tflops/s, 16.771 iter/s, 5.963e-02 s/iter, (0.301, 0.001, 0.239) sec
mfu: 162.282 Tflops/s, hfu: 162.282 Tflops/s, 18.449 iter/s, 5.420e-02 s/iter, (0.296, 0.001, 0.217) sec
mfu: 178.596 Tflops/s, hfu: 178.596 Tflops/s, 20.304 iter/s, 4.925e-02 s/iter, (0.390, 0.001, 0.197) sec
da_config: SP=(4,8),Sg=(8192,8192),S=(262144,262144),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 104.882 Tflops/s, hfu: 104.882 Tflops/s, 2.981 iter/s, 3.355e-01 s/iter, (0.687, 0.001, 1.342) sec
# orchestrated_attn_func
mfu: 203.861 Tflops/s, hfu: 203.861 Tflops/s, 5.794 iter/s, 1.726e-01 s/iter, (0.544, 0.001, 0.690) sec
mfu: 205.242 Tflops/s, hfu: 205.242 Tflops/s, 5.833 iter/s, 1.714e-01 s/iter, (0.526, 0.001, 0.686) sec
mfu: 212.387 Tflops/s, hfu: 212.387 Tflops/s, 6.036 iter/s, 1.657e-01 s/iter, (0.520, 0.001, 0.663) sec
mfu: 166.991 Tflops/s, hfu: 166.991 Tflops/s, 4.746 iter/s, 2.107e-01 s/iter, (0.598, 0.001, 0.843) sec
mfu: 183.572 Tflops/s, hfu: 183.572 Tflops/s, 5.217 iter/s, 1.917e-01 s/iter, (0.575, 0.001, 0.767) sec
mfu: 188.038 Tflops/s, hfu: 188.038 Tflops/s, 5.344 iter/s, 1.871e-01 s/iter, (0.587, 0.001, 0.748) sec
da_config: SP=(4,8),Sg=(16384,16384),S=(524288,524288),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, fwd
mfu: 139.009 Tflops/s, hfu: 139.009 Tflops/s, 0.988 iter/s, 1.012e+00 s/iter, (2.026, 0.001, 4.050) sec
# orchestrated_attn_func
mfu: 212.064 Tflops/s, hfu: 212.064 Tflops/s, 1.507 iter/s, 6.637e-01 s/iter, (1.553, 0.001, 2.655) sec
mfu: 211.761 Tflops/s, hfu: 211.761 Tflops/s, 1.505 iter/s, 6.646e-01 s/iter, (1.507, 0.001, 2.658) sec
mfu: 219.459 Tflops/s, hfu: 219.459 Tflops/s, 1.559 iter/s, 6.413e-01 s/iter, (1.464, 0.001, 2.565) sec
mfu: 183.051 Tflops/s, hfu: 183.051 Tflops/s, 1.301 iter/s, 7.688e-01 s/iter, (1.686, 0.001, 3.075) sec
mfu: 167.267 Tflops/s, hfu: 167.267 Tflops/s, 1.189 iter/s, 8.414e-01 s/iter, (1.860, 0.001, 3.366) sec
mfu: 195.307 Tflops/s, hfu: 195.307 Tflops/s, 1.388 iter/s, 7.206e-01 s/iter, (1.736, 0.001, 2.882) sec
causal=False, fob=1:
da_config: SP=(4,8),Sg=(256,256),S=(8192,8192),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 0.119 Tflops/s, hfu: 0.149 Tflops/s, 55.517 iter/s, 1.801e-02 s/iter, (1.291, 0.001, 0.072) sec
# orchestrated_attn_func
mfu: 2.396 Tflops/s, hfu: 2.995 Tflops/s, 1115.553 iter/s, 8.964e-04 s/iter, (0.266, 0.001, 0.004) sec
mfu: 2.61 Tflops/s, hfu: 3.262 Tflops/s, 1215.220 iter/s, 8.229e-04 s/iter, (0.180, 0.001, 0.003) sec
mfu: 2.809 Tflops/s, hfu: 3.511 Tflops/s, 1308.079 iter/s, 7.645e-04 s/iter, (0.181, 0.001, 0.003) sec
mfu: 2.754 Tflops/s, hfu: 3.442 Tflops/s, 1282.420 iter/s, 7.798e-04 s/iter, (0.179, 0.001, 0.003) sec
mfu: 2.879 Tflops/s, hfu: 3.598 Tflops/s, 1340.454 iter/s, 7.460e-04 s/iter, (0.180, 0.001, 0.003) sec
mfu: 2.989 Tflops/s, hfu: 3.736 Tflops/s, 1391.750 iter/s, 7.185e-04 s/iter, (0.179, 0.001, 0.003) sec
da_config: SP=(4,8),Sg=(512,512),S=(16384,16384),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 0.491 Tflops/s, hfu: 0.614 Tflops/s, 57.216 iter/s, 1.748e-02 s/iter, (0.038, 0.001, 0.070) sec
# orchestrated_attn_func
mfu: 7.874 Tflops/s, hfu: 9.843 Tflops/s, 916.705 iter/s, 1.091e-03 s/iter, (0.181, 0.001, 0.004) sec
mfu: 8.523 Tflops/s, hfu: 10.654 Tflops/s, 992.245 iter/s, 1.008e-03 s/iter, (0.182, 0.001, 0.004) sec
mfu: 7.658 Tflops/s, hfu: 9.573 Tflops/s, 891.513 iter/s, 1.122e-03 s/iter, (0.180, 0.000, 0.004) sec
mfu: 9.922 Tflops/s, hfu: 12.402 Tflops/s, 1155.065 iter/s, 8.658e-04 s/iter, (0.180, 0.001, 0.003) sec
mfu: 9.886 Tflops/s, hfu: 12.358 Tflops/s, 1150.896 iter/s, 8.689e-04 s/iter, (0.181, 0.001, 0.003) sec
mfu: 11.169 Tflops/s, hfu: 13.961 Tflops/s, 1300.228 iter/s, 7.691e-04 s/iter, (0.180, 0.001, 0.003) sec
da_config: SP=(4,8),Sg=(1024,1024),S=(32768,32768),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 1.841 Tflops/s, hfu: 2.302 Tflops/s, 53.593 iter/s, 1.866e-02 s/iter, (0.041, 0.001, 0.075) sec
# orchestrated_attn_func
mfu: 22.226 Tflops/s, hfu: 27.783 Tflops/s, 646.874 iter/s, 1.546e-03 s/iter, (0.184, 0.001, 0.006) sec
mfu: 22.841 Tflops/s, hfu: 28.551 Tflops/s, 664.752 iter/s, 1.504e-03 s/iter, (0.183, 0.001, 0.006) sec
mfu: 23.716 Tflops/s, hfu: 29.645 Tflops/s, 690.219 iter/s, 1.449e-03 s/iter, (0.181, 0.001, 0.006) sec
mfu: 27.737 Tflops/s, hfu: 34.672 Tflops/s, 807.264 iter/s, 1.239e-03 s/iter, (0.181, 0.001, 0.005) sec
mfu: 24.586 Tflops/s, hfu: 30.732 Tflops/s, 715.541 iter/s, 1.398e-03 s/iter, (0.182, 0.001, 0.006) sec
mfu: 26.664 Tflops/s, hfu: 33.33 Tflops/s, 776.036 iter/s, 1.289e-03 s/iter, (0.182, 0.001, 0.005) sec
da_config: SP=(4,8),Sg=(2048,2048),S=(65536,65536),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 7.734 Tflops/s, hfu: 9.667 Tflops/s, 56.271 iter/s, 1.777e-02 s/iter, (0.042, 0.001, 0.071) sec
# orchestrated_attn_func
mfu: 47.017 Tflops/s, hfu: 58.772 Tflops/s, 342.096 iter/s, 2.923e-03 s/iter, (0.186, 0.001, 0.012) sec
mfu: 46.155 Tflops/s, hfu: 57.693 Tflops/s, 335.819 iter/s, 2.978e-03 s/iter, (0.186, 0.001, 0.012) sec
mfu: 45.953 Tflops/s, hfu: 57.441 Tflops/s, 334.351 iter/s, 2.991e-03 s/iter, (0.185, 0.001, 0.012) sec
mfu: 53.544 Tflops/s, hfu: 66.93 Tflops/s, 389.587 iter/s, 2.567e-03 s/iter, (0.182, 0.001, 0.010) sec
mfu: 60.824 Tflops/s, hfu: 76.03 Tflops/s, 442.552 iter/s, 2.260e-03 s/iter, (0.185, 0.001, 0.009) sec
mfu: 54.861 Tflops/s, hfu: 68.577 Tflops/s, 399.168 iter/s, 2.505e-03 s/iter, (0.188, 0.001, 0.010) sec
da_config: SP=(4,8),Sg=(4096,4096),S=(131072,131072),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 31.069 Tflops/s, hfu: 38.837 Tflops/s, 56.515 iter/s, 1.769e-02 s/iter, (0.040, 0.001, 0.071) sec
# orchestrated_attn_func
mfu: 82.644 Tflops/s, hfu: 103.305 Tflops/s, 150.328 iter/s, 6.652e-03 s/iter, (0.195, 0.001, 0.027) sec
mfu: 82.345 Tflops/s, hfu: 102.931 Tflops/s, 149.785 iter/s, 6.676e-03 s/iter, (0.192, 0.001, 0.027) sec
mfu: 84.369 Tflops/s, hfu: 105.461 Tflops/s, 153.467 iter/s, 6.516e-03 s/iter, (0.192, 0.001, 0.026) sec
mfu: 94.104 Tflops/s, hfu: 117.63 Tflops/s, 171.174 iter/s, 5.842e-03 s/iter, (0.190, 0.001, 0.023) sec
mfu: 100.757 Tflops/s, hfu: 125.946 Tflops/s, 183.275 iter/s, 5.456e-03 s/iter, (0.197, 0.001, 0.022) sec
mfu: 95.529 Tflops/s, hfu: 119.411 Tflops/s, 173.766 iter/s, 5.755e-03 s/iter, (0.191, 0.001, 0.023) sec
da_config: SP=(4,8),Sg=(8192,8192),S=(262144,262144),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 83.623 Tflops/s, hfu: 104.529 Tflops/s, 38.027 iter/s, 2.630e-02 s/iter, (0.056, 0.001, 0.105) sec
# orchestrated_attn_func
mfu: 127.597 Tflops/s, hfu: 159.496 Tflops/s, 58.024 iter/s, 1.723e-02 s/iter, (0.216, 0.001, 0.069) sec
mfu: 127.154 Tflops/s, hfu: 158.942 Tflops/s, 57.823 iter/s, 1.729e-02 s/iter, (0.217, 0.000, 0.069) sec
mfu: 126.594 Tflops/s, hfu: 158.243 Tflops/s, 57.568 iter/s, 1.737e-02 s/iter, (0.213, 0.001, 0.069) sec
mfu: 127.458 Tflops/s, hfu: 159.322 Tflops/s, 57.961 iter/s, 1.725e-02 s/iter, (0.213, 0.001, 0.069) sec
mfu: 129.102 Tflops/s, hfu: 161.378 Tflops/s, 58.709 iter/s, 1.703e-02 s/iter, (0.213, 0.001, 0.068) sec
mfu: 124.033 Tflops/s, hfu: 155.041 Tflops/s, 56.404 iter/s, 1.773e-02 s/iter, (0.215, 0.002, 0.071) sec
da_config: SP=(4,8),Sg=(16384,16384),S=(524288,524288),Nh=(1,1),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 92.466 Tflops/s, hfu: 115.582 Tflops/s, 10.512 iter/s, 9.513e-02 s/iter, (0.194, 0.001, 0.381) sec
# orchestrated_attn_func
mfu: 142.584 Tflops/s, hfu: 178.23 Tflops/s, 16.210 iter/s, 6.169e-02 s/iter, (0.302, 0.001, 0.247) sec
mfu: 143.673 Tflops/s, hfu: 179.591 Tflops/s, 16.334 iter/s, 6.122e-02 s/iter, (0.305, 0.001, 0.245) sec
mfu: 144.42 Tflops/s, hfu: 180.525 Tflops/s, 16.419 iter/s, 6.091e-02 s/iter, (0.307, 0.001, 0.244) sec
mfu: 142.114 Tflops/s, hfu: 177.642 Tflops/s, 16.156 iter/s, 6.189e-02 s/iter, (0.303, 0.001, 0.248) sec
mfu: 146.624 Tflops/s, hfu: 183.28 Tflops/s, 16.669 iter/s, 5.999e-02 s/iter, (0.300, 0.001, 0.240) sec
mfu: 143.454 Tflops/s, hfu: 179.317 Tflops/s, 16.309 iter/s, 6.132e-02 s/iter, (0.304, 0.001, 0.245) sec
da_config: SP=(4,8),Sg=(256,256),S=(8192,8192),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 2.985 Tflops/s, hfu: 3.731 Tflops/s, 43.433 iter/s, 2.302e-02 s/iter, (0.049, 0.001, 0.092) sec
# orchestrated_attn_func
mfu: 21.821 Tflops/s, hfu: 27.276 Tflops/s, 317.532 iter/s, 3.149e-03 s/iter, (0.208, 0.000, 0.013) sec
mfu: 21.939 Tflops/s, hfu: 27.424 Tflops/s, 319.259 iter/s, 3.132e-03 s/iter, (0.188, 0.001, 0.013) sec
mfu: 20.417 Tflops/s, hfu: 25.521 Tflops/s, 297.101 iter/s, 3.366e-03 s/iter, (0.190, 0.001, 0.013) sec
da_config: SP=(4,8),Sg=(512,512),S=(16384,16384),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 7.4 Tflops/s, hfu: 9.249 Tflops/s, 26.919 iter/s, 3.715e-02 s/iter, (0.079, 0.001, 0.149) sec
# orchestrated_attn_func
mfu: 49.563 Tflops/s, hfu: 61.954 Tflops/s, 180.310 iter/s, 5.546e-03 s/iter, (0.195, 0.000, 0.022) sec
mfu: 44.797 Tflops/s, hfu: 55.997 Tflops/s, 162.972 iter/s, 6.136e-03 s/iter, (0.195, 0.001, 0.025) sec
mfu: 45.624 Tflops/s, hfu: 57.03 Tflops/s, 165.980 iter/s, 6.025e-03 s/iter, (0.193, 0.001, 0.024) sec
da_config: SP=(4,8),Sg=(1024,1024),S=(32768,32768),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 15.117 Tflops/s, hfu: 18.897 Tflops/s, 13.749 iter/s, 7.273e-02 s/iter, (0.153, 0.001, 0.291) sec
# orchestrated_attn_func
mfu: 90.172 Tflops/s, hfu: 112.715 Tflops/s, 82.011 iter/s, 1.219e-02 s/iter, (0.221, 0.001, 0.049) sec
mfu: 80.949 Tflops/s, hfu: 101.186 Tflops/s, 73.623 iter/s, 1.358e-02 s/iter, (0.212, 0.001, 0.054) sec
mfu: 82.531 Tflops/s, hfu: 103.163 Tflops/s, 75.061 iter/s, 1.332e-02 s/iter, (0.208, 0.001, 0.053) sec
da_config: SP=(4,8),Sg=(2048,2048),S=(65536,65536),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 30.25 Tflops/s, hfu: 37.813 Tflops/s, 6.878 iter/s, 1.454e-01 s/iter, (0.298, 0.001, 0.582) sec
# orchestrated_attn_func
mfu: 119.908 Tflops/s, hfu: 149.885 Tflops/s, 27.264 iter/s, 3.668e-02 s/iter, (0.259, 0.001, 0.147) sec
mfu: 115.616 Tflops/s, hfu: 144.52 Tflops/s, 26.288 iter/s, 3.804e-02 s/iter, (0.261, 0.001, 0.152) sec
mfu: 118.167 Tflops/s, hfu: 147.709 Tflops/s, 26.868 iter/s, 3.722e-02 s/iter, (0.262, 0.001, 0.149) sec
da_config: SP=(4,8),Sg=(4096,4096),S=(131072,131072),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 56.038 Tflops/s, hfu: 70.047 Tflops/s, 3.185 iter/s, 3.139e-01 s/iter, (0.640, 0.001, 1.256) sec
# orchestrated_attn_func
mfu: 129.303 Tflops/s, hfu: 161.629 Tflops/s, 7.350 iter/s, 1.361e-01 s/iter, (0.517, 0.001, 0.544) sec
mfu: 130.038 Tflops/s, hfu: 162.547 Tflops/s, 7.392 iter/s, 1.353e-01 s/iter, (0.463, 0.001, 0.541) sec
mfu: 128.588 Tflops/s, hfu: 160.735 Tflops/s, 7.309 iter/s, 1.368e-01 s/iter, (0.463, 0.001, 0.547) sec
da_config: SP=(4,8),Sg=(8192,8192),S=(262144,262144),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 67.377 Tflops/s, hfu: 84.221 Tflops/s, 0.957 iter/s, 1.044e+00 s/iter, (1.724, 0.001, 4.178) sec
# orchestrated_attn_func
mfu: 130.906 Tflops/s, hfu: 163.633 Tflops/s, 1.860 iter/s, 5.376e-01 s/iter, (1.287, 0.001, 2.150) sec
mfu: 131.131 Tflops/s, hfu: 163.913 Tflops/s, 1.863 iter/s, 5.366e-01 s/iter, (1.273, 0.001, 2.147) sec
mfu: 131.391 Tflops/s, hfu: 164.239 Tflops/s, 1.867 iter/s, 5.356e-01 s/iter, (1.270, 0.001, 2.142) sec
da_config: SP=(4,8),Sg=(16384,16384),S=(524288,524288),Nh=(32,32),bs=1,D=128,causal=False,hierarchy=1:
YXs: [(1, 4), (2, 2), (4, 1)]
# ring_flash_attn_func, bwd
mfu: 85.815 Tflops/s, hfu: 107.268 Tflops/s, 0.305 iter/s, 3.280e+00 s/iter, (6.599, 0.001, 13.120) sec
# orchestrated_attn_func
mfu: 126.425 Tflops/s, hfu: 158.031 Tflops/s, 0.449 iter/s, 2.226e+00 s/iter, (4.698, 0.001, 8.906) sec
mfu: 126.613 Tflops/s, hfu: 158.267 Tflops/s, 0.450 iter/s, 2.223e+00 s/iter, (4.668, 0.001, 8.892) sec
mfu: 125.893 Tflops/s, hfu: 157.366 Tflops/s, 0.447 iter/s, 2.236e+00 s/iter, (4.618, 0.001, 8.943) sec
+ set +x
